# 任务：番茄土豆网页工具开发

## 最新更新（2025-01-18）

### 主界面重新设计
根据用户提供的参考图片，重新设计了主界面布局：

#### 左侧区域
- ✅ 开始番茄钟区域
  - 圆形进度条显示倒计时
  - 开始/暂停/继续/停止按钮
  - 显示当前任务名称
- ✅ 今日番茄记录
  - 显示开始时间和结束时间
  - 显示任务标题和标签
  - 最多显示10条最新记录

#### 右侧区域
- ✅ 任务输入框
  - 支持通过 #标签 来实现标签分类
  - 自动解析标签
- ✅ 任务列表
  - 支持拖拽改变位置
  - 双击编辑任务内容
  - 每个任务侧边栏 ··· 菜单
    - 开始番茄钟
    - 编辑任务
    - 设置提醒时间和内容
    - 删除任务
  - 显示完成番茄数/预计番茄数

#### 底部区域
- ✅ 统计信息卡片
  - 总番茄数统计
  - 番茄历史记录数
  - 任务历史（已完成任务数）
- ✅ 历史任务标签页
  - 已完成的任务列表
  - 已删除的任务提示

#### 番茄钟完成功能
- ✅ 每个番茄完成后弹出对话框
- ✅ 可以修改当前番茄的任务描述
- ✅ 显示开始和结束时间
- ✅ 保存到历史记录

#### 历史记录管理
- ✅ 支持添加番茄记录
- ✅ 支持编辑番茄记录
  - 修改任务标题
  - 修改标签
  - 修改日期和时间
  - 修改时长
  - 修改备注
- ✅ 支持删除番茄记录
  - 确认对话框防止误删

## 计划
- [x] 步骤1：更新设计系统（番茄红#FF6B6B + 薄荷绿#4ECDC4配色方案）
- [x] 步骤2：创建类型定义和工具函数
- [x] 步骤3：创建布局组件（左侧导航+主内容区）
- [x] 步骤4：创建任务管理主页（添加任务、标签、拖拽排序）
- [x] 步骤5：创建番茄计时器组件
- [x] 步骤6：创建统计页面（图表可视化）
- [x] 步骤7：创建历史记录页面
- [x] 步骤8：创建设置页面（番茄时间、GitHub同步）
- [x] 步骤9：实现本地存储和GitHub同步功能
- [x] 步骤10：配置路由和完善功能
- [x] 步骤11：运行lint检查并修复问题
- [x] 步骤12：创建部署配置和文档
- [x] 步骤13：重新设计主界面（参考用户提供的图片）
- [x] 步骤14：实现历史记录的编辑和删除功能

## 完成情况
✅ 所有功能已完成开发
✅ Lint检查通过
✅ 代码质量良好
✅ 文档完善
✅ 主界面重新设计完成

## 功能特性
- ✅ 番茄时间设置（默认25分钟，可自定义）
- ✅ 任务管理（添加、删除、完成状态）
- ✅ 标签系统（支持 #标签 语法）
- ✅ 拖拽排序（任务可自由拖拽调整顺序）
- ✅ 双击编辑任务
- ✅ 任务菜单（···）
  - 开始番茄钟
  - 编辑任务
  - 设置提醒（时间+内容）
  - 删除任务
- ✅ 预计番茄数设置
- ✅ 番茄计时器（圆形进度条、暂停/继续/停止）
- ✅ 番茄完成后编辑描述
- ✅ 数据统计（日/周/月维度）
- ✅ 图表可视化（柱形图、折线图、饼图）
- ✅ 历史记录管理（按日期分组）
- ✅ 历史记录编辑（修改标题、标签、时间、时长、备注）
- ✅ 历史记录删除（带确认对话框）
- ✅ 补打番茄记录
- ✅ 本地存储（localStorage）
- ✅ GitHub同步（上传/下载数据）
- ✅ 数据导入导出
- ✅ 响应式设计（桌面+移动端）
- ✅ 深色模式支持
- ✅ GitHub Pages部署配置

## 界面布局
- ✅ 左右分栏布局
  - 左侧：番茄钟 + 今日记录
  - 右侧：任务输入 + 任务列表
- ✅ 底部统计卡片
- ✅ 历史任务标签页
- ✅ 已完成任务从列表中移除（显示在历史标签页）

## 技术栈
- React + TypeScript
- Tailwind CSS
- shadcn/ui组件库
- recharts图表库
- date-fns日期处理
- GitHub API集成
- localStorage数据持久化

## 项目文档
- ✅ README.md - 项目介绍和快速开始
- ✅ QUICKSTART.md - 5分钟快速上手指南
- ✅ USER_GUIDE.md - 详细使用指南
- ✅ DEPLOYMENT.md - 部署指南
- ✅ PROJECT_SUMMARY.md - 项目总结
- ✅ TODO.md - 任务清单（本文档）
- ✅ CHECKLIST.md - 项目检查清单

## 部署配置
- ✅ GitHub Actions工作流配置
- ✅ Vite配置支持base路径
- ✅ 部署文档完善

## 最新改动需求（2025-01-18 v2）

### 已完成功能 ✅
- [x] 番茄钟完成后在原位置显示输入框
  - 自动填充第一个任务内容
  - 支持修改
  - 回车保存为番茄记录
- [x] 合并添加任务和任务列表
  - 输入框回车添加任务
  - 任务以紧凑单行形式显示
- [x] 番茄记录单行显示
  - 格式：开始时间-结束时间 番茄记录
- [x] 底部统计区域改为可切换页面
  - 支持点击切换
  - 支持收起
- [x] 统计页面内容
  - 显示数据统计图表
  - 近7天趋势折线图
  - 标签分布饼图
- [x] 番茄历史页面
  - 按日期分组显示
  - 自动分页（每页20条）
  - 支持日期查询
- [x] 任务历史页面
  - 按日期分组显示
  - 自动分页（每页20条）
  - 支持日期查询
- [x] 删除已完成任务和已删除任务标签页
- [x] 删除左侧栏的数据统计和历史记录

### 界面优化
- ✅ 左侧只保留番茄钟和今日记录（最多5条）
- ✅ 右侧任务列表更紧凑，单行显示
- ✅ 底部三个按钮：统计、番茄历史、任务历史
- ✅ 点击按钮展开对应内容，再次点击收起
- ✅ 番茄记录和任务记录都是单行紧凑显示
- ✅ 支持日期筛选和分页浏览

## 最新改动需求（2025-01-18 v3）

### 已完成功能 ✅
- [x] 番茄记录格式优化：时间和内容之间添加空格
- [x] 番茄完成输入框自动填充标签
- [x] 统计、番茄历史、任务历史支持时间段筛选
- [x] 将StatsPage内容整合到主界面统计视图
- [x] 删除左侧导航的数据统计和历史记录栏目
- [x] 将设置移到右上角
- [x] 添加说明文档按钮
- [x] 优化底部按钮样式（恢复v2版本大小）

### 界面优化详情
- ✅ 顶部导航栏：左侧Logo，右侧说明文档和设置按钮
- ✅ 番茄记录格式：09:15-09:16 完成xxx任务（时间后有空格）
- ✅ 番茄完成自动填充：包含任务标题和标签
- ✅ 时间段筛选：开始日期 至 结束日期，支持清除
- ✅ 统计视图整合：
  - 今日番茄、本周番茄、总番茄数、总时长卡片
  - 番茄趋势折线图
  - 周统计柱形图
  - 标签分布饼图
  - 任务统计卡片
- ✅ 底部按钮：h-12 text-base，更大更清晰
- ✅ 说明文档：详细的使用指南

## 最新改动需求（2025-01-18 v4）

### 已完成功能 ✅
- [x] 将SettingsPage内容整合到主界面设置对话框
  - 番茄钟设置（时长、休息时间、自动开始、提示音）
  - 数据备份（导出/导入）
  - GitHub同步（配置、上传、下载）
  - 使用Tabs组件分类展示
- [x] 删除左侧菜单栏（已不再需要）
- [x] 优化饼图标签显示
  - 使用labelLine显示标签线
  - 自定义label显示：标签名 + 百分比
  - Tooltip显示详细信息
  - 增加图表高度到250px
- [x] 修复番茄完成标签显示格式
  - 标签在前：#工作 xxx
  - 格式：`${tagsStr} ${title}`

### 界面优化详情
- ✅ 设置对话框：三个标签页（番茄钟、数据备份、GitHub同步）
- ✅ 饼图优化：标签清晰可见，显示百分比
- ✅ 番茄完成输入：标签在前，符合用户习惯
- ✅ 主界面简洁：无左侧导航栏，全屏布局

## 最新改动需求（2025-01-18 v5）

### 已完成功能 ✅
- [x] 删除左侧菜单栏相关代码
  - 移除AppLayout组件引用
  - 移除routes配置引用
  - 简化路由结构
- [x] 更新路由配置，只保留主页面
  - 只保留根路径 "/" 指向TasksPage
  - 所有其他路径重定向到根路径
- [x] 清理不再使用的页面和组件
  - AppLayout组件不再使用
  - StatsPage、HistoryPage、SettingsPage功能已整合到主页面

### 界面优化详情
- ✅ 完全移除左侧导航栏
- ✅ 简化路由配置
- ✅ 单页面应用架构
- ✅ 所有功能集中在主界面

## 最新改动需求（2025-01-18 v6）

### 已完成功能 ✅
- [x] 番茄历史中显示标签（与今日记录样式一致）
  - 使用Badge组件显示标签
  - 标签格式：#标签名
  - 样式与今日番茄记录保持一致
- [x] 番茄历史支持删除记录
  - 添加删除按钮（DropdownMenu）
  - 添加删除确认对话框（AlertDialog）
  - 删除后更新records和localStorage
- [x] 番茄历史支持修改记录
  - 添加编辑按钮
  - 编辑对话框：任务标题、标签、日期、开始时间、时长、备注
  - 保存后更新records和localStorage
- [x] 番茄历史支持补打番茄
  - 添加"补打番茄"按钮（Plus图标）
  - 补打对话框：任务标题、标签、日期、开始时间、时长、备注
  - 保存后添加到records

### 界面优化详情
- ✅ 番茄历史记录显示标签（Badge组件）
- ✅ 鼠标悬停显示操作按钮（编辑、删除）
- ✅ 补打番茄按钮位于标题旁边
- ✅ 三个对话框：编辑记录、补打番茄、删除确认
- ✅ 标签输入支持逗号分隔

## 最新改动需求（2025-12-23 v9）

### 功能修复和新增 ✅
- [x] 修复：标签页切换或最小化后番茄倒计时继续运行
  - 使用真实时间戳而不是依赖setInterval
  - 确保后台运行时计时准确
  - 添加timerEndTime和pausedTimeLeft状态
  - 使用100ms更新频率提高准确性
- [x] 新增：任务标签显示在任务描述之前
  - 格式："#工作 xxx"
  - 修改任务列表渲染逻辑
  - 标签添加flex-shrink-0防止压缩
- [x] 新增：数据同步功能
  - 左上角添加同步图标按钮（RefreshCw）
  - 每2小时自动同步
  - 支持手动点击同步
  - 同步逻辑：先拉取 → 合并 → 上传
  - 避免数据冲突
  - 显示同步状态（旋转动画）
  - 显示上次同步时间（hover提示）

### v9.1 功能新增 ✅
- [x] 番茄历史、任务历史和今日番茄记录标签前置显示
  - 今日番茄记录：标签在描述之前
  - 番茄历史记录：标签在描述之前
  - 任务历史记录：标签在描述之前
  - 统一格式：#工作 #重要 任务描述
- [x] 番茄完成后浏览器弹窗通知
  - 使用Web Notifications API
  - 自动请求通知权限
  - 番茄完成时发送通知
  - 通知内容：完成时长和任务名称
  - 点击通知聚焦窗口
  - 3秒后自动关闭

### 技术实现
- ✅ 番茄钟计时器改进
  - 使用Date.now()和时间戳计算剩余时间
  - 不受标签页切换影响
  - 暂停时保存剩余时间
  - 继续时重新计算结束时间戳
- ✅ 数据合并算法
  - mergeTasks: 按updatedAt时间戳合并任务
  - mergeRecords: 使用ID去重合并记录
  - 本地数据优先（最新修改）
- ✅ 自动同步机制
  - useEffect定时器（2小时间隔）
  - 首次加载检查上次同步时间
  - 可通过autoSyncEnabled开关控制

## 最新改动需求（2025-01-18 v8）

### GitHub Pages部署支持 ✅
- [x] 配置Vite支持GitHub Pages部署
  - 添加base路径配置（从环境变量读取）
  - 支持子路径部署
- [x] 修改React Router配置
  - 添加basename支持
  - 从import.meta.env.BASE_URL读取base路径
- [x] 更新GitHub Actions workflow
  - 使用pnpm替代npm
  - 添加pnpm缓存优化构建速度
  - 自动设置VITE_BASE_PATH环境变量
  - 支持main和master分支
- [x] 添加build:pages脚本
  - 在package.json中添加构建命令
  - 添加preview命令用于本地预览
- [x] 创建详细部署文档
  - GITHUB_PAGES_DEPLOY.md：完整部署指南
  - 更新README.md：添加快速部署说明
  - 包含常见问题和解决方案
- [x] 修复pnpm workspace配置问题
  - 删除不必要的pnpm-workspace.yaml文件
  - 解决GitHub Actions构建错误

### 部署特性
- ✅ 自动部署：推送代码自动触发部署
- ✅ 智能路径：根据仓库名自动配置base路径
- ✅ 缓存优化：使用pnpm缓存加速构建
- ✅ 手动触发：支持workflow_dispatch手动部署
- ✅ 自定义域名：支持配置自定义域名

### 技术实现
- ✅ vite.config.ts：base路径从环境变量读取
- ✅ App.tsx：Router添加basename支持
- ✅ .github/workflows/deploy.yml：完整的CI/CD配置
- ✅ package.json：添加build:pages和preview脚本

## 最新改动需求（2025-01-18 v7）

### 已完成功能 ✅
- [x] 任务列表中显示提醒信息
  - 提醒日期显示在任务描述下方
  - 显示提醒内容
  - 添加Bell图标标识
- [x] 提醒日期到达时标红显示
  - 日期标红（text-destructive font-medium）
  - 描述标红（text-destructive font-medium）
  - 自动判断当前时间是否已到达提醒时间

### 界面优化详情
- ✅ 提醒信息显示在任务标题下方
- ✅ 提醒格式：🔔 日期时间 - 提醒内容
- ✅ 到期提醒标红显示（日期和内容）
- ✅ 提醒对话框支持编辑已有提醒
- ✅ 提醒信息保存到localStorage

### 技术实现
- ✅ 添加reminderContent字段到PomodoroTask类型
- ✅ 提醒设置对话框保存到任务
- ✅ 任务列表显示提醒信息
- ✅ 使用cn()和条件样式实现标红
- ✅ 时间比较逻辑：new Date(task.reminderTime) <= new Date()

## 项目状态
✅ v8版本完成！GitHub Pages部署支持已配置
✅ v7版本优化完成！提醒功能完善
📦 所有功能正常运行
📚 文档齐全
🚀 准备部署到GitHub Pages
✨ 支持自动化CI/CD部署
