# 番茄土豆 v9 功能测试指南

## 测试环境准备

### 1. 启动应用
```bash
cd /workspace/app-8bamp6ymrksh
pnpm install
pnpm run dev
```

### 2. 准备GitHub仓库（用于同步测试）
1. 创建一个GitHub仓库（公开或私有）
2. 创建Personal Access Token
   - 访问：https://github.com/settings/tokens
   - 点击"Generate new token (classic)"
   - 勾选`repo`权限
   - 生成并复制token

## 功能测试清单

### ✅ 测试1：番茄钟后台运行

**测试步骤**：
1. 点击"开始番茄钟"按钮
2. 等待5秒，记录当前剩余时间（如24:55）
3. 切换到其他标签页或最小化浏览器
4. 等待30秒
5. 切换回番茄土豆标签页
6. 检查剩余时间是否正确（应该是24:25左右）

**预期结果**：
- ✅ 时间继续倒计时
- ✅ 时间准确（误差<1秒）
- ✅ 进度条正常更新

**测试暂停/继续**：
1. 开始番茄钟
2. 点击"暂停"
3. 切换标签页等待10秒
4. 切换回来，时间应该保持不变
5. 点击"继续"
6. 切换标签页等待10秒
7. 切换回来，时间应该减少了10秒

### ✅ 测试2：任务标签前置显示

**测试步骤**：
1. 在任务输入框输入：`写代码 #工作 #重要`
2. 按回车添加任务
3. 检查任务列表中的显示顺序

**预期结果**：
- ✅ 标签显示在前：`#工作 #重要 写代码`
- ✅ 标签不被压缩
- ✅ 标签和描述之间有适当间距

**测试编辑任务**：
1. 双击任务进入编辑模式
2. 输入框应显示：`写代码 #工作 #重要`（标签在后）
3. 修改后保存
4. 显示时标签应该在前

### ✅ 测试3：数据同步功能

#### 3.1 配置GitHub同步

**测试步骤**：
1. 点击右上角设置按钮
2. 滚动到"GitHub同步设置"
3. 填写配置：
   ```
   Token: ghp_xxxxxxxxxxxx
   Owner: your-username
   Repo: pomodoro-backup
   Branch: main
   File Path: pomodoro-data.json
   ```
4. 勾选"启用GitHub同步"
5. 点击"保存设置"

**预期结果**：
- ✅ 配置保存成功
- ✅ 左上角出现同步按钮（🔄图标）

#### 3.2 手动同步测试

**测试步骤**：
1. 添加几个任务
2. 完成一个番茄钟
3. 点击左上角同步按钮
4. 观察同步过程

**预期结果**：
- ✅ 按钮图标开始旋转
- ✅ 显示"同步成功"提示
- ✅ 提示显示合并的任务和记录数量
- ✅ Hover按钮显示上次同步时间
- ✅ GitHub仓库中出现`pomodoro-data.json`文件

#### 3.3 数据合并测试

**测试步骤**：
1. 在设备A上添加任务"任务A"
2. 点击同步
3. 在设备B上添加任务"任务B"
4. 点击同步
5. 在设备A上点击同步
6. 检查任务列表

**预期结果**：
- ✅ 设备A显示"任务A"和"任务B"
- ✅ 没有重复任务
- ✅ 所有数据都保留

**测试冲突解决**：
1. 在设备A上修改任务"任务A"的标题为"任务A-修改1"
2. 不同步
3. 在设备B上修改同一任务的标题为"任务A-修改2"
4. 设备B先同步
5. 设备A再同步
6. 检查最终结果

**预期结果**：
- ✅ 保留最新修改（根据updatedAt时间戳）
- ✅ 不会丢失数据

#### 3.4 自动同步测试

**测试步骤**：
1. 配置GitHub同步
2. 等待2小时（或修改代码中的间隔时间为1分钟测试）
3. 观察是否自动同步

**预期结果**：
- ✅ 2小时后自动触发同步
- ✅ 显示同步成功提示
- ✅ 更新上次同步时间

**快速测试方法**：
修改`TasksPage.tsx`中的自动同步间隔：
```typescript
// 将 2 * 60 * 60 * 1000 改为 60 * 1000（1分钟）
const interval = setInterval(() => {
  handleSmartSync();
}, 60 * 1000); // 1分钟测试
```

### ✅ 测试4：错误处理

#### 4.1 网络错误

**测试步骤**：
1. 断开网络连接
2. 点击同步按钮

**预期结果**：
- ✅ 显示"同步失败"提示
- ✅ 显示错误信息
- ✅ 按钮停止旋转

#### 4.2 配置错误

**测试步骤**：
1. 使用错误的Token
2. 点击同步按钮

**预期结果**：
- ✅ 显示"上传失败"提示
- ✅ 显示具体错误信息（如"Bad credentials"）

#### 4.3 未配置同步

**测试步骤**：
1. 不配置GitHub同步
2. 检查左上角

**预期结果**：
- ✅ 不显示同步按钮
- ✅ 应用正常使用

## 性能测试

### 测试5：大数据量

**测试步骤**：
1. 添加100个任务
2. 完成50个番茄钟
3. 点击同步

**预期结果**：
- ✅ 同步成功
- ✅ 时间<5秒
- ✅ 数据完整

### 测试6：频繁同步

**测试步骤**：
1. 连续点击同步按钮5次

**预期结果**：
- ✅ 第一次点击触发同步
- ✅ 同步期间按钮禁用
- ✅ 不会重复同步

## 兼容性测试

### 浏览器测试
- [ ] Chrome/Edge
- [ ] Firefox
- [ ] Safari
- [ ] 移动端浏览器

### 功能兼容
- [ ] 旧数据导入
- [ ] 设置迁移
- [ ] 历史记录保留

## 回归测试

确保新功能不影响现有功能：

- [ ] 添加任务
- [ ] 编辑任务
- [ ] 删除任务
- [ ] 拖拽排序
- [ ] 设置提醒
- [ ] 查看统计
- [ ] 查看历史
- [ ] 导出/导入数据

## 测试报告模板

```markdown
## 测试报告

**测试日期**: 2025-12-23
**测试人员**: [姓名]
**测试环境**: 
- 浏览器: Chrome 120
- 操作系统: Windows 11

### 测试结果

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 番茄钟后台运行 | ✅ | 时间准确 |
| 任务标签前置 | ✅ | 显示正常 |
| 手动同步 | ✅ | 同步成功 |
| 自动同步 | ✅ | 2小时触发 |
| 数据合并 | ✅ | 无冲突 |
| 错误处理 | ✅ | 提示清晰 |

### 发现的问题

1. [问题描述]
   - 重现步骤：
   - 预期结果：
   - 实际结果：
   - 严重程度：

### 建议

1. [改进建议]
```

## 调试技巧

### 查看同步日志
打开浏览器控制台（F12），查看：
- 网络请求（Network标签）
- 控制台输出（Console标签）

### 查看本地数据
```javascript
// 在控制台执行
localStorage.getItem('pomodoro-tasks')
localStorage.getItem('pomodoro-records')
localStorage.getItem('pomodoro-settings')
```

### 清除测试数据
```javascript
// 在控制台执行
localStorage.clear()
location.reload()
```

---

**测试完成后请填写测试报告并提交反馈！**
